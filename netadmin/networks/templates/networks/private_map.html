{% extends "base.html" %}
{% comment %}
Copyright (C) 2011 Adriano Monteiro Marques

Author: Amit Pal <amix.pal@gmail.com>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
{% load i18n %}
{% block title %}

<!DOCTYPE html>
<title>Map</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0px; padding: 0px; }
  #map_canvas { height: 100% }
</style>

<script type="text/javascript"
src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCVSS35Ufsv0aEf0lV4qTIWnWg5Wnl55as&sensor=true">
</script>

<script type="text/javascript">
  var map ;
  var flightPlanCoordinatesSet = [];
  function initialize() {
    var latlng = new google.maps.LatLng(-34.397, 150.644);
    var myOptions = {
      zoom: 4,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.TERRAIN 
    };
    
    map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
     
    var flightPlanCoordinates = [ {% for ip in latlng %}{{ ip }}{% endfor %}];
    var msg = [{% for i in message %}"{{ i }}"{% if forloop.last %}{%else%},{%endif%}{% endfor %}];
    var time = [{% for j in timestamp %}"{{ j }}"{% if forloop.last %}{%else%},{%endif%}{% endfor %}];
    var type = [{% for k in event_type %}"{{ k }}"{% if forloop.last %}{%else%},{%endif%}{% endfor %}];
    var host = [{% for l in host %}"{{ l }}"{% if forloop.last %}{%else%},{%endif%}{% endfor %}];
    
    for(var i in flightPlanCoordinates){
		flightPlanCoordinatesSet.push(new google.maps.LatLng(flightPlanCoordinates[i][0], flightPlanCoordinates[i][1]));
		
		var myHtml = "<table style='background:#B3ADB1; color:black' width='300'><tr><td align='center'><strong>" + host[i] + " 's Detail"+ "</strong></td></tr></table>"
		+"<table border='3' style='border-color:#AF9BCF; background:#E4DDF0; color:black;' width='300' cellpadding='3' cellspacing='3'>"+
		"<tr><td width = '100'><strong>Event Message:</strong></td><td width = '200'>" + msg[i] + "</td></tr>"+
		"<tr><td width = '100'><strong>Generated Time:</strong></td><td width = '200'>" + time[i] + "</td></tr>"+
		"<tr><td width = '100'><strong>Event Type:</strong></td><td width = '200'>" + type[i] + "</td></tr>"+
		"</table><p style='font-family:verdana,arial,sans-serif;font-size:100%;'>"
		var marker = add_marker(flightPlanCoordinates[i][0], flightPlanCoordinates[i][1],"Event Detail",myHtml);
		marker.setMap(map);
		}
		
		var flightPath = new google.maps.Polyline({
                     path: flightPlanCoordinatesSet,
                     strokeColor: "#FF0000",
                     strokeOpacity: 1.0,
                     strokeWeight: 2
					  });
		flightPath.setMap(map);
	}
   
  function add_marker(lat,lng,title,box_html) {
    var infowindow = new google.maps.InfoWindow({
        content: box_html
    });
 
    var marker = new google.maps.Marker({
          position: new google.maps.LatLng(lat,lng),
          map: map,
          title: title
    });
       
    google.maps.event.addListener(marker, 'click', function() {
      infowindow.open(map,this);
    });   
       
    return marker;
  }
	</script>
<body onload="initialize()"> 
  <div id="map_canvas" style="margin:5px; width:100%; height:100%"></div> 

{% endblock %}

{% block meta %}
<ul>	
	<li class="alert"><a href="{% url events_list %}">{% trans "Events" %}</a></li>
</ul>
{% endblock %}
