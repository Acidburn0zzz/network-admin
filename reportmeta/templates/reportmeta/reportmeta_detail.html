{% extends "base.html" %}
{% comment %}
Copyright (C) 2011 Adriano Monteiro Marques

Author: Piotrek Wasilewski <wasilewski.piotrek@gmail.com>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
{% load i18n %}
{% block title %}{% trans "report" %}{% endblock %}

{% block content %}

<h2>{{ object.name }}</h2>

<p>{{ object.description }}</p>
<p>Report for {{ object.object_type.name }}: <a href="{{ object.reported_object.get_absolute_url }}">{{ object.reported_object.name }}</a></p>

{% if object.object_type.name == 'network' %}
<p>Hosts in the report: 
{% for host in object.reported_object.get_hosts|slice:":5" %}
	{{ host.name }}{% if not forloop.last %}, {% endif %}
{% endfor %}
{% if object.reported_object.get_hosts_count > 5 %},...{% endif %}
</p>
{% endif %}

<h2>{% trans "Events" %}</h2>

{% if object.has_events %}
<table>
	<thead>
		<tr><th>{% trans "Timestamp" %}</th><th>{% trans "Message" %}</th><th>{% trans "Event type" %}</th><th>{% trans "Host" %}</th></tr>
	</thead>
	<tbody>
	{% for event in object.get_events %}
		<tr>
			<td>{{ event.timestamp }}</td>
			<td><a href="{% url event_detail event.pk %}">{{ event.message }}</a></td>
			<td>{{ event.event_type }}</td>
			<td><a href="{% url host_detail event.source_host.pk %}">{{ event.source_host.name }}</a></td>
		</tr>
	{% endfor %}
	</tbody>
</table>
{% else %}
<p>No events have been reported yet.</p>
{% endif %}

{% endblock %}

{% block sidebar %}
<ul>
	<li><a href="{% url reportmeta_get_report object.pk %}">{% trans "Get report in PDF" %}</a></li>
	<li><a href="{% url reportmeta_update object.pk %}">{% trans "Edit report" %}</a></li>
	<li><a href="{% url reportmeta_delete object.pk %}">{% trans "Delete report" %}</a></li>
	<li><a href="{% url reportmeta_list object.object_type.name %}">{% blocktrans with object.object_type.name as name %}Back to {{ name }} reports{% endblocktrans %}</a></li>
	{% if object.object_type.name == 'host' %}
	<li><a href="{% url reportmeta_list 'network' %}">{% trans "Go to network reports" %}</a></li>
	{% else %}
	<li><a href="{% url reportmeta_list 'host' %}">{% trans "Go to host reports" %}</a></li>
	{% endif %}
</ul>
{% endblock %}